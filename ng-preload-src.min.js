/*! ng-preload-src - v 0.0.4 - Tue Apr 29 2014 17:48:17 GMT+0800 (CST)
 * https://github.com/tomchentw/ng-preload-src
 * Copyright (c) 2014 [tomchentw](https://github.com/tomchentw);
 * Licensed [MIT](http://tomchentw.mit-license.org)
 */
(function(t,e,o){t.module("ng-preload-src",[]).factory("$image",["$window","$q"].concat(function(o,r){return{preload:function(a){var n,s;return n=r.defer(),s=new o.Image,s.src=a,t.element(s).on("load",e(n,n.resolve,a)),n.promise}}})).directive("preloadWithDefaultSrc",["$interpolate","$image","$injector","$timeout"].concat(function(t,r,a,n){function s(t,e,o,r){e.on("load",r.onLoadEvent)}var i;return i=function(){function s(o,r){this.$scope=o,this.$attrs=r,this.lastUrl=void 0,this.onImagePreloaded=e(this,this.onImagePreloaded),this.onLoadEvent=e(this,this.onLoadEvent),o.$watch(t(r.preloadSrc),e(this,this.onSrcChanged))}s.displayName="PreloadCtrl";var i=s.prototype,l=s;return s.cfpLoadingBar=a.get("cfpLoadingBar")||{start:o,set:o,complete:o},s.reqsTotal=s.reqsCompleted=0,s.startTimeout=void 0,i.onSrcChanged=function(t){this.$attrs.$set("ngSrc",this.$attrs.preloadWithDefaultSrc),this.lastUrl=t,this.$scope.$root.$broadcast("cfpLoadingBar:loading",{url:t}),0===l.reqsTotal&&(l.startTimeout=n(function(){l.cfpLoadingBar.start()},100)),l.reqsTotal++,l.cfpLoadingBar.set(l.reqsCompleted/l.reqsTotal),r.preload(t).then(this.onImagePreloaded)},i.onImagePreloaded=function(t){this.lastUrl===t&&this.$attrs.$set("ngSrc",t)},i.onLoadEvent=function(){this.lastUrl===this.$attrs.ngSrc&&(l.reqsCompleted++,this.$scope.$root.$broadcast("cfpLoadingBar:loaded",{url:this.lastUrl}),l.reqsCompleted>=l.reqsTotal?(n.cancel(l.startTimeout),l.cfpLoadingBar.complete(),l.reqsCompleted=l.reqsTotal=0):l.cfpLoadingBar.set(l.reqsCompleted/l.reqsTotal))},s.$inject=["$scope","$attrs"],s}(),{controller:i,require:"preloadWithDefaultSrc",compile:function(t,e){return e.$set("preloadSrc",e.ngSrc),e.$set("ngSrc",e.preloadWithDefaultSrc),s}}}))}).call(this,angular,angular.bind,angular.noop);